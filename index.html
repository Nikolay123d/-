<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Прага-Фушки | Допомога Українцям</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: url('https://i.ibb.co/fbpjfnm/Prague.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
    }
    .tabs {
      display: flex;
      justify-content: space-around;
      background-color: rgba(0,0,0,0.7);
      padding: 10px;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    .tabs button {
      background: none;
      border: none;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }
    .section {
      display: none;
      padding: 20px;
      backdrop-filter: blur(10px);
    }
    .section.active { display: block; }
    #chat-box { max-height: 70vh; overflow-y: auto; margin-bottom: 10px; }
    .message { margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; }
    input, button { padding: 10px; border-radius: 5px; border: none; }
    .map { height: 60vh; width: 100%; margin-top: 20px; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
  <div class="tabs">
    <button data-tab="chat" class="active">Чат</button>
    <button data-tab="map">Карта</button>
    <button data-tab="info">Корисна інформація</button>
  </div>

  <div id="chat" class="section active">
    <p><em>Шановні українці! Цей сайт створено, щоб допомагати нашим співвітчизникам у Празі.</em></p>
    <div id="chat-box"></div>
    <input id="msg" placeholder="Ваше повідомлення" />
    <input id="img" type="file" accept="image/*" />
    <button id="send">Надіслати</button>
  </div>

  <div id="map" class="section">
    <div class="map" id="map-container"></div>
  </div>

  <div id="info" class="section">
    <h3>Медичні центри</h3>
    <p>Лікарня Мотол, Поліклініка Прага 1, тощо...</p>
    <h3>Соціальні служби</h3>
    <p>OAMP, Центри допомоги...</p>
    <h3>Магазини</h3>
    <p>Українські продукти, гуманітарна допомога...</p>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDV2BslF-Ll37a1XO3GEfzNMXa7YsSXL1o",
      authDomain: "web-app-b4633.firebaseapp.com",
      projectId: "web-app-b4633",
      storageBucket: "web-app-b4633.appspot.com",
      messagingSenderId: "1041887915171",
      appId: "1:1041887915171:web:84d62eae54e9291b47a316"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    let user = JSON.parse(localStorage.getItem('chatUser'));
    if (!user) {
      const nick = prompt('Ваш нікнейм:');
      const email = prompt('Ваш email:');
      const pass = prompt('Створіть пароль:');
      auth.createUserWithEmailAndPassword(email, pass)
        .then(cred => {
          user = { nick, uid: cred.user.uid };
          localStorage.setItem('chatUser', JSON.stringify(user));
        })
        .catch(() => alert('Можливо, користувач вже існує.'));
    }

    const sendBtn = document.getElementById("send");
    const msgInput = document.getElementById("msg");
    const imgInput = document.getElementById("img");
    const chatBox = document.getElementById("chat-box");

    function loadMessages() {
      db.collection("messages").orderBy("time")
        .onSnapshot(snapshot => {
          chatBox.innerHTML = "";
          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement("div");
            div.className = "message";
            div.innerHTML = `<strong>${data.nick}</strong>: ${data.text || ''}`;
            if (data.image) {
              div.innerHTML += `<br><img src="${data.image}" width="100"/>`;
            }
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
          });
        });
    }
    loadMessages();

    sendBtn.onclick = async () => {
      const text = msgInput.value.trim();
      const file = imgInput.files[0];
      let img64 = null;
      if (file) {
        const reader = new FileReader();
        reader.onload = async () => {
          img64 = reader.result;
          await db.collection("messages").add({
            nick: user.nick,
            text,
            image: img64,
            time: new Date()
          });
          msgInput.value = "";
          imgInput.value = null;
        };
        reader.readAsDataURL(file);
      } else if (text) {
        await db.collection("messages").add({
          nick: user.nick,
          text,
          image: null,
          time: new Date()
        });
        msgInput.value = "";
      }
    };

    document.querySelectorAll('.tabs button').forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
        document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
        document.getElementById(btn.dataset.tab).classList.add('active');
        btn.classList.add('active');
      };
    });

    // Карта
    const map = L.map('map-container').setView([50.0755, 14.4378], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    const points = [
      { name: "Лікарня Мотол", lat: 50.0737, lng: 14.3456 },
      { name: "OAMP Прага", lat: 50.087, lng: 14.423 },
      { name: "Магазин Pomoc", lat: 50.073, lng: 14.418 }
    ];
    points.forEach(p => L.marker([p.lat, p.lng]).addTo(map).bindPopup(p.name));
  </script>
</body>
</html>
