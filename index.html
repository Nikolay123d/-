<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ü—Ä–∞–≥–∞-–§—É—à–∫–∏ ‚Äî –î–æ–ø–æ–º–æ–≥–∞ —É–∫—Ä–∞—ó–Ω—Ü—è–º —É –ü—Ä–∞–∑—ñ</title>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
  import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";

  // Firebase –∫–æ–Ω—Ñ—ñ–≥
  const firebaseConfig = {
    apiKey: "AIzaSyDV2BslF-Ll37a1XO3GEfzNMXa7YsSXL1o",
    authDomain: "web-app-b4633.firebaseapp.com",
    databaseURL: "https://web-app-b4633-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "web-app-b4633",
    storageBucket: "web-app-b4633.firebasestorage.app",
    messagingSenderId: "1041887915171",
    appId: "1:1041887915171:web:84d62eae54e9291b47a316",
    measurementId: "G-C65BPE81SJ"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  window.firebaseApp = app;
  window.firebaseDB = db;
  window.firebaseAuth = auth;
</script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap');

  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Montserrat', sans-serif;
    background: url('https://i.ibb.co/fbpjfnm/Prague.jpg') no-repeat center center fixed;
    background-size: cover;
    overflow: hidden;
  }
  #app {
    height: 100%;
    display: flex; flex-direction: column;
    background-color: rgba(255 255 255 / 0.15);
    backdrop-filter: blur(7px);
  }
  header {
    background-color: rgba(0 0 0 / 0.5);
    color: #fff;
    padding: 10px 15px;
    font-weight: 600;
    font-size: 1.2rem;
    text-align: center;
  }
  nav {
    display: flex;
    background: rgba(0 0 0 / 0.6);
  }
  nav button {
    flex: 1;
    padding: 12px;
    background: transparent;
    border: none;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s;
  }
  nav button.active, nav button:hover {
    background: #ffd700aa;
    color: black;
  }
  main {
    flex: 1;
    overflow: hidden;
    position: relative;
    display: flex;
  }

  /* –°–µ–∫—Ü–∏–∏ */
  section {
    display: none;
    height: 100%;
    width: 100%;
    overflow-y: auto;
    padding: 15px;
    box-sizing: border-box;
  }
  section.active {
    display: block;
  }

  /* –ß–∞—Ç */
  #chat {
    display: flex;
    flex-direction: column;
    height: 100%;
    background-color: rgba(255 255 255 / 0.25);
    border-radius: 8px;
    box-shadow: 0 0 10px #0004;
  }
  #chat-header {
    padding: 10px;
    font-weight: 700;
    font-size: 1.1rem;
    color: #222;
    text-align: center;
    background: #fff7;
    border-radius: 8px 8px 0 0;
  }
  #messages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    background: rgba(255 255 255 / 0.7);
    border-radius: 0 0 8px 8px;
  }
  .message {
    margin-bottom: 12px;
    font-size: 0.95rem;
    line-height: 1.3;
  }
  .message.sent {
    text-align: right;
    color: #003366;
  }
  .message.received {
    text-align: left;
    color: #333;
  }
  .message img {
    max-width: 180px;
    max-height: 180px;
    margin-top: 5px;
    border-radius: 6px;
    object-fit: contain;
    box-shadow: 0 0 6px #999;
  }

  #input-area {
    display: flex;
    padding: 8px;
    background: #fff8;
    align-items: center;
    border-radius: 0 0 8px 8px;
    gap: 8px;
  }
  #text-input {
    flex: 1;
    padding: 8px 12px;
    font-size: 1rem;
    border: 1px solid #aaa;
    border-radius: 6px;
  }
  #file-input {
    display: none;
  }
  #file-label {
    cursor: pointer;
    font-size: 1.3rem;
    color: #555;
  }
  #send-btn {
    background-color: #ffd700;
    border: none;
    padding: 10px 15px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s;
  }
  #send-btn:hover:not([disabled]) {
    background-color: #ffbf00;
  }
  #send-btn:disabled {
    background-color: #ddd;
    cursor: not-allowed;
  }

  /* –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ (–º–æ–¥–∞–ª–∫–∞) */
  #auth-modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 20;
  }
  #auth-modal.active {
    display: flex;
  }
  #auth-form {
    background: white;
    padding: 20px 25px;
    border-radius: 12px;
    width: 320px;
    max-width: 90vw;
    box-shadow: 0 0 20px #00000044;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  #auth-form h2 {
    margin: 0 0 10px 0;
    font-weight: 700;
    text-align: center;
  }
  #auth-form input {
    padding: 10px;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  #auth-form button {
    padding: 10px;
    background-color: #ffd700;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  #auth-form button:hover {
    background-color: #ffbf00;
  }
  #auth-error {
    color: red;
    font-size: 0.85rem;
    text-align: center;
  }

  /* –ö–∞—Ä—Ç–∞ */
  #map {
    height: 100%;
    width: 100%;
    border-radius: 8px;
    box-shadow: 0 0 10px #0005;
  }
  /* –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º */
  .filter-buttons {
    margin-bottom: 10px;
    text-align: center;
  }
  .filter-buttons button {
    margin: 0 6px 8px 6px;
    padding: 8px 14px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    background-color: #ffd700cc;
    font-weight: 600;
    color: black;
  }
  .filter-buttons button.active {
    background-color: #ffbf00;
  }

  /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */
  #info {
    color: #222;
    background: rgba(255 255 255 / 0.85);
    border-radius: 8px;
    padding: 15px;
    overflow-y: auto;
    box-shadow: 0 0 10px #0004;
  }
  #info h2 {
    text-align: center;
    font-weight: 700;
    margin-bottom: 15px;
    color: #005500;
  }
  #info p {
    margin-bottom: 12px;
    font-size: 1rem;
    line-height: 1.4;
  }
  #info img {
    max-width: 100%;
    border-radius: 8px;
    margin-bottom: 15px;
    box-shadow: 0 0 12px #ccc;
  }

  /* –ê–¥–∞–ø—Ç–∏–≤ */
  @media (max-width: 600px) {
    nav button {
      font-size: 0.9rem;
      padding: 10px 4px;
    }
    #auth-form {
      width: 90vw;
    }
  }
</style>

<!-- Leaflet –¥–ª—è –∫–∞—Ä—Ç—ã -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  crossorigin=""
/>

</head>
<body>
<div id="app">
  <header>–®–∞–Ω–æ–≤–Ω—ñ —É–∫—Ä–∞—ó–Ω—Ü—ñ! –¶–µ–π —Å–∞–π—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ, —â–æ–± –¥–æ–ø–æ–º–∞–≥–∞—Ç–∏ –Ω–∞—à–∏–º —Å–ø—ñ–≤–≤—ñ—Ç—á–∏–∑–Ω–∏–∫–∞–º —É –ü—Ä–∞–∑—ñ.</header>
  <nav>
    <button class="active" data-tab="chat-tab">–ß–∞—Ç</button>
    <button data-tab="map-tab">–ö–∞—Ä—Ç–∞ –¥–æ–ø–æ–º–æ–≥–∏</button>
    <button data-tab="info-tab">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</button>
  </nav>
  <main>
    <!-- –ß–∞—Ç -->
    <section id="chat-tab" class="active">
      <div id="chat">
        <div id="chat-header">–í—ñ—Ç–∞—î–º–æ —É —á–∞—Ç—ñ –ü—Ä–∞–≥–∞-–§—É—à–∫–∏! –¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –¥–æ–ø–æ–º–æ–≥—É —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫—É.</div>
        <div id="messages"></div>
        <div id="input-area">
          <input id="text-input" type="text" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." autocomplete="off" />
          <label for="file-input" id="file-label" title="–î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ üì∑">&#128247;</label>
          <input type="file" id="file-input" accept="image/*" />
          <button id="send-btn" disabled>–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
        </div>
      </div>
    </section>

    <!-- –ö–∞—Ä—Ç–∞ -->
    <section id="map-tab">
      <div class="filter-buttons">
        <button class="active" data-filter="all">–í—Å—ñ</button>
        <button data-filter="medicine">–ú–µ–¥–∏—Ü–∏–Ω–∞</button>
        <button data-filter="social">–°–æ—Ü—Å–ª—É–∂–±–∏</button>
        <button data-filter="shops">–ú–∞–≥–∞–∑–∏–Ω–∏</button>
        <button data-filter="law">–Æ—Ä–∏–¥–∏—á–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞</button>
      </div>
      <div id="map"></div>
    </section>

    <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è -->
    <section id="info-tab">
      <div id="info">
        <h2>–ö–æ—Ä–∏—Å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è —É–∫—Ä–∞—ó–Ω—Ü—ñ–≤ —É –ü—Ä–∞–∑—ñ</h2>
        <p>–¶–µ–π —Ä–æ–∑–¥—ñ–ª –º—ñ—Å—Ç–∏—Ç—å –≤–∞–∂–ª–∏–≤—ñ –∫–æ–Ω—Ç–∞–∫—Ç–∏, –ø–æ—Ä–∞–¥–∏ —Ç–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è —à–≤–∏–¥–∫–æ—ó –¥–æ–ø–æ–º–æ–≥–∏.</p>
        <img src="https://upload.wikimedia.org/wikipedia/commons/7/7e/Prague_Castle_from_the_Vltava_River.jpg" alt="–ü—Ä–∞–≥–∞" />
        <p><b>–ú–µ–¥–∏—Ü–∏–Ω–∞:</b> —Ç—É—Ç –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —Å–ø–∏—Å–æ–∫ –∫–ª—ñ–Ω—ñ–∫ —ñ –ª—ñ–∫–∞—Ä–µ–Ω—å, —â–æ –ø—Ä–∏–π–º–∞—é—Ç—å —É–∫—Ä–∞—ó–Ω—Ü—ñ–≤.</p>
        <p><b>–°–æ—Ü—Å–ª—É–∂–±–∏:</b> –∫–æ–Ω—Ç–∞–∫—Ç–∏ –≤–æ–ª–æ–Ω—Ç–µ—Ä—Å—å–∫–∏—Ö —Ü–µ–Ω—Ç—Ä—ñ–≤ —ñ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π –¥–æ–ø–æ–º–æ–≥–∏.</p>
        <p><b>–ú–∞–≥–∞–∑–∏–Ω–∏:</b> —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –º–∞–≥–∞–∑–∏–Ω–∏ —Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ñ –º–∞—Ä–∫–µ—Ç–∏.</p>
        <p><b>–Æ—Ä–∏–¥–∏—á–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞:</b> –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —É –ø—Ä–∞–≤–æ–≤–∏—Ö –ø–∏—Ç–∞–Ω–Ω—è—Ö.</p>
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/8e/Charles_Bridge_Prague.jpg" alt="–ü—Ä–∞–≥–∞ –º—ñ—Å—Ç" />
      </div>
    </section>
  </main>
</div>

<div id="auth-modal">
  <form id="auth-form">
    <h2>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è / –í—Ö—ñ–¥</h2>
    <input id="nickname" type="text" placeholder="–ù—ñ–∫–Ω–µ–π–º" required />
    <input id="email" type="email" placeholder="Email" required />
    <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å" required minlength="6" />
    <button type="submit">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
    <div id="auth-error"></div>
  </form>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script type="module">
  import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";

  const db = window.firebaseDB;
  const auth = window.firebaseAuth;

  // –í–∫–ª–∞–¥–∫–∏
  const tabButtons = document.querySelectorAll('nav button');
  const sections = document.querySelectorAll('main section');
  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      tabButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const tab = btn.dataset.tab;
      sections.forEach(section => {
        section.classList.toggle('active', section.id === tab);
      });
    });
  });

  // –≠–ª–µ–º–µ–Ω—Ç—ã —á–∞—Ç–∞
  const messagesContainer = document.getElementById("messages");
  const textInput = document.getElementById("text-input");
  const fileInput = document.getElementById("file-input");
  const sendBtn = document.getElementById("send-btn");
  const authModal = document.getElementById("auth-modal");
  const authForm = document.getElementById("auth-form");
  const authError = document.getElementById("auth-error");
  const nicknameInput = document.getElementById("nickname");
  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");

  let currentUser = null;
  let isAuthModalOpen = false;
  let pendingMessage = null; // –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏ —Ñ–æ—Ç–æ, –æ–∂–∏–¥–∞—é—â–∏—Ö –æ—Ç–ø—Ä–∞–≤–∫–∏

  function enableSendBtn() {
    sendBtn.disabled = !(textInput.value.trim() || fileInput.files.length > 0);
  }
  textInput.addEventListener("input", enableSendBtn);
  fileInput.addEventListener("change", enableSendBtn);

  // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Firebase Realtime Database
  async function sendMessage(text, imageBase64) {
    if (!currentUser) return;
    const messagesRef = ref(db, "messages");
    const msgData = {
      uid: currentUser.uid,
      nickname: currentUser.displayName || currentUser.email,
      text: text || "",
      image: imageBase64 || null,
      timestamp: Date.now()
    };
    await push(messagesRef, msgData);
  }

  // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –±–∞–∑—ã
  function renderMessages(messages) {
    messagesContainer.innerHTML = "";
    messages.forEach(msg => {
      const div = document.createElement("div");
      div.className = `message ${msg.uid === (currentUser?.uid) ? 'sent' : 'received'}`;
      const nicknameSpan = `<strong>${msg.nickname || "User"}</strong><br>`;
      const textSpan = `<span>${msg.text || ""}</span>`;
      const imgTag = msg.image ? `<br><img src="${msg.image}" alt="–§–æ—Ç–æ"/>` : "";
      div.innerHTML = nicknameSpan + textSpan + imgTag;
      messagesContainer.appendChild(div);
    });
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
  }

  // –°–ª—É—à–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –±–∞–∑—ã
  const messagesRef = ref(db, "messages");
  onValue(messagesRef, snapshot => {
    const data = snapshot.val();
    if (!data) {
      renderMessages([]);
      return;
    }
    const msgs = Object.values(data).sort((a,b) => a.timestamp - b.timestamp);
    renderMessages(msgs);
  });

  // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ
  sendBtn.onclick = () => {
    if (!currentUser) {
      // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ
      pendingMessage = {
        text: textInput.value.trim(),
        file: fileInput.files[0] || null
      };
      authModal.classList.add("active");
      isAuthModalOpen = true;
      return;
    }

    const text = textInput.value
const text = textInput.value.trim();
    const file = fileInput.files[0];

    if (!text && !file) return;

    if (file) {
      const reader = new FileReader();
      reader.onload = async () => {
        await sendMessage(text, reader.result);
        textInput.value = "";
        fileInput.value = null;
        sendBtn.disabled = true;
      };
      reader.readAsDataURL(file);
    } else {
      sendMessage(text, null);
      textInput.value = "";
      sendBtn.disabled = true;
    }
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è / –≤—Ö–æ–¥)
  authForm.addEventListener("submit", async e => {
    e.preventDefault();
    authError.textContent = "";
    const nickname = nicknameInput.value.trim();
    const email = emailInput.value.trim();
    const password = passwordInput.value;

    if (!nickname || !email || !password) {
      authError.textContent = "–í—Å—ñ –ø–æ–ª—è –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ.";
      return;
    }

    try {
      // –ü—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;
      // –û–±–Ω–æ–≤–∏–º displayName –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      await user.updateProfile({ displayName: nickname });
      currentUser = user;

      authModal.classList.remove("active");
      isAuthModalOpen = false;

      // –ï—Å–ª–∏ –±—ã–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ–∂–∏–¥–∞–Ω–∏–∏, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
      if (pendingMessage) {
        if (pendingMessage.file) {
          const reader = new FileReader();
          reader.onload = async () => {
            await sendMessage(pendingMessage.text, reader.result);
            clearInputAfterSend();
          };
          reader.readAsDataURL(pendingMessage.file);
        } else {
          await sendMessage(pendingMessage.text, null);
          clearInputAfterSend();
        }
        pendingMessage = null;
      }
    } catch (error) {
      if (error.code === "auth/email-already-in-use") {
        // –ï—Å–ª–∏ –ø–æ—á—Ç–∞ –∑–∞–Ω—è—Ç–∞ ‚Äî –ø–æ–ø—Ä–æ–±—É–µ–º –≤–æ–π—Ç–∏
        try {
          const userCredential = await signInWithEmailAndPassword(auth, email, password);
          currentUser = userCredential.user;
          authModal.classList.remove("active");
          isAuthModalOpen = false;
          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –±—ã–ª–æ
          if (pendingMessage) {
            if (pendingMessage.file) {
              const reader = new FileReader();
              reader.onload = async () => {
                await sendMessage(pendingMessage.text, reader.result);
                clearInputAfterSend();
              };
              reader.readAsDataURL(pendingMessage.file);
            } else {
              await sendMessage(pendingMessage.text, null);
              clearInputAfterSend();
            }
            pendingMessage = null;
          }
        } catch (signInError) {
          authError.textContent = "–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É: " + signInError.message;
        }
      } else {
        authError.textContent = "–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó: " + error.message;
      }
    }
  });

  function clearInputAfterSend() {
    textInput.value = "";
    fileInput.value = null;
    sendBtn.disabled = true;
  }

  // –°–ª–µ–¥–∏–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  onAuthStateChanged(auth, user => {
    if (user) {
      currentUser = user;
      nicknameInput.value = user.displayName || "";
    } else {
      currentUser = null;
    }
  });

  // –ö–∞—Ä—Ç–∞ Leaflet
  import L from "https://unpkg.com/leaflet@1.9.4/dist/leaflet-src.js";

  const map = L.map('map').setView([50.0755, 14.4378], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ—á–µ–∫
  const categories = {
    all: [],
    medicine: [
      { name: '–õ—ñ–∫–∞—Ä–Ω—è –ú–æ—Ç–æ–ª', lat: 50.0737, lng: 14.3456 },
      { name: '–ü–æ–ª—ñ–∫–ª—ñ–Ω—ñ–∫–∞ –ü—Ä–∞–≥–∞ 1', lat: 50.082, lng: 14.423 },
      { name: '–ö–ª—ñ–Ω—ñ–∫–∞ –°–≤.–õ—É–∫–∏', lat: 50.085, lng: 14.42 },
      { name: '–ê–ø—Ç–µ–∫–∞ U Lek√°rn√≠', lat: 50.08, lng: 14.43 }
    ],
    social: [
      { name: 'OAMP –ü—Ä–∞–≥–∞ 1', lat: 50.087, lng: 14.423 },
      { name: '–í–æ–ª–æ–Ω—Ç–µ—Ä—Å—å–∫–∏–π —Ü–µ–Ω—Ç—Ä Pomoc', lat: 50.081, lng: 14.449 },
      { name: '–¶–µ–Ω—Ç—Ä —Å–æ—Ü—ñ–∞–ª—å–Ω–æ—ó –¥–æ–ø–æ–º–æ–≥–∏', lat: 50.076, lng: 14.44 }
    ],
    shops: [
      { name: '–ú–∞–≥–∞–∑–∏–Ω Pomoc', lat: 50.073, lng: 14.418 },
      { name: '–£–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π –º–∞–≥–∞–∑–∏–Ω', lat: 50.079, lng: 14.42 },
      { name: '–°—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç Billa', lat: 50.077, lng: 14.435 }
    ],
    law: [
      { name: '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è Pravda', lat: 50.085, lng: 14.420 },
      { name: '–Æ—Ä–∏–¥–∏—á–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –£–∫—Ä–∞—ó–Ω—Ü—è–º', lat: 50.088, lng: 14.425 }
    ]
  };

  // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Ç–æ—á–∫–∏ –≤ all
  for (let cat in categories) {
    if (cat !== 'all') categories.all.push(...categories[cat]);
  }

  let markers = [];
  function renderMarkers(filter) {
    markers.forEach(m => map.removeLayer(m));
    markers = [];
    const points = categories[filter] || [];
    points.forEach(p => {
      const marker = L.marker([p.lat, p.lng]).addTo(map).bindPopup(p.name);
      markers.push(marker);
    });
  }

  renderMarkers('all');

  document.querySelectorAll('.filter-buttons button').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.filter-buttons button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      renderMarkers(btn.dataset.filter);
    });
  });

</script>

</body>
</html>
