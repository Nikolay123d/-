<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü–æ–º—ñ—á —É –ü—Ä–∞–∑—ñ</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: url('https://i.ibb.co/fbpjfnm/Prague.jpg') no-repeat center center fixed;
      background-size: cover;
    }
    header, nav, section, footer {
      padding: 1rem;
      color: white;
    }
    .tabs {
      display: flex;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
    }
    .tabs button {
      background: none;
      border: none;
      padding: 1rem;
      color: white;
      font-weight: bold;
      cursor: pointer;
      flex: 1;
    }
    .tabs button.active {
      border-bottom: 3px solid #fff;
    }
    section {
      display: none;
    }
    section.active {
      display: block;
    }
    #chat {
      height: 80vh;
      display: flex;
      flex-direction: column;
      backdrop-filter: blur(8px);
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
    }
    #messages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }
    #messages div {
      margin-bottom: 0.5rem;
      background: rgba(255, 255, 255, 0.2);
      padding: 0.5rem;
      border-radius: 5px;
    }
    #chat form {
      display: flex;
      padding: 1rem;
      gap: 0.5rem;
    }
    #chat input[type="text"] {
      flex: 1;
      padding: 0.5rem;
      border-radius: 5px;
      border: none;
    }
    #mapid {
      height: 80vh;
      border-radius: 10px;
    }
    .filter-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }
    .filter-buttons button {
      padding: 0.5rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    @media (max-width: 600px) {
      .tabs button {
        padding: 0.5rem;
        font-size: 0.9rem;
      }
      #chat, #mapid {
        height: 70vh;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>–î–æ–ø–æ–º–æ–≥–∞ —É–∫—Ä–∞—ó–Ω—Ü—è–º —É –ü—Ä–∞–∑—ñ</h1>
  </header>
  <nav class="tabs">
    <button data-tab="chat" class="active" aria-pressed="true">–ß–∞—Ç</button>
    <button data-tab="map">–ö–∞—Ä—Ç–∞ –¥–æ–ø–æ–º–æ–≥–∏</button>
    <button data-tab="info">–ö–æ—Ä–∏—Å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</button>
  </nav>

  <section id="chat" class="active">
    <div id="messages"></div>
    <form id="chatForm">
      <input type="text" id="messageInput" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." required />
      <input type="file" id="imageInput" accept="image/*">
      <button type="submit">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
    </form>
  </section>

  <section id="map">
    <div class="filter-buttons">
      <button onclick="updateMarkers('all')">–í—Å—ñ</button>
      <button onclick="updateMarkers('medicine')">–ú–µ–¥–∏—Ü–∏–Ω–∞</button>
      <button onclick="updateMarkers('social')">–°–æ—Ü—ñ–∞–ª—å–Ω–∞</button>
      <button onclick="updateMarkers('shops')">–ú–∞–≥–∞–∑–∏–Ω–∏/–ö—É—Ä—Å–∏</button>
      <button onclick="updateMarkers('law')">–Æ—Ä–∏–¥–∏—á–Ω–∞</button>
    </div>
    <div id="mapid"></div>
  </section>

  <section id="info">
    <p>üìû –ì–∞—Ä—è—á—ñ –ª—ñ–Ω—ñ—ó, –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞, –ø—Ä–∏—Ç—É–ª–∫–∏ —Ç–∞ —ñ–Ω—à–µ ‚Äî —Å–∫–æ—Ä–æ —Ç—É—Ç!</p>
  </section>

  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDV2BslF-Ll37a1XO3GEfzNMXa7YsSXL1o",
      authDomain: "web-app-b4633.firebaseapp.com",
      projectId: "web-app-b4633",
      storageBucket: "web-app-b4633.appspot.com",
      messagingSenderId: "1041887915171",
      appId: "1:1041887915171:web:84d62eae54e9291b47a316",
      measurementId: "G-C65BPE81SJ",
      databaseURL: "https://web-app-b4633-default-rtdb.europe-west1.firebasedatabase.app/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let username = localStorage.getItem('username');
    if (!username) {
      username = prompt('–í–∞—à –Ω—ñ–∫–Ω–µ–π–º:');
      const email = prompt('Email:');
      const password = prompt('–ü–∞—Ä–æ–ª—å:');
      localStorage.setItem('username', username);
    }

    const messagesRef = db.ref('messages');

    document.getElementById('chatForm').addEventListener('submit', e => {
      e.preventDefault();
      const text = document.getElementById('messageInput').value;
      const file = document.getElementById('imageInput').files[0];

      if (file && file.size > 5 * 1024 * 1024) {
        alert('–§–∞–π–ª –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–∏–π (–º–∞–∫—Å–∏–º—É–º 5MB).');
        return;
      }

      const msg = { user: username, text, time: Date.now() };
      messagesRef.push(msg);
      document.getElementById('messageInput').value = '';
    });

    messagesRef.on('child_added', snapshot => {
      const msg = snapshot.val();
      const div = document.createElement('div');
      div.innerHTML = `<strong>${msg.user}</strong>: ${msg.text}`;
      document.getElementById('messages').appendChild(div);
      document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
    });

    const tabButtons = document.querySelectorAll('nav button');
    const sections = document.querySelectorAll('section');
    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        tabButtons.forEach(b => {
          b.classList.remove('active');
          b.setAttribute('aria-pressed', 'false');
        });
        sections.forEach(sec => sec.classList.remove('active'));
        const tab = btn.getAttribute('data-tab');
        document.getElementById(tab).classList.add('active');
        btn.classList.add('active');
        btn.setAttribute('aria-pressed', 'true');
      });
    });
  </script>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('mapid').setView([50.0755, 14.4378], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap'
    }).addTo(map);

    const points = [
      { id: 1, category: 'medicine', name: '–õ—ñ–∫–∞—Ä–Ω—è –ú–æ—Ç–æ–ª', coords: [50.078, 14.345], phone: '+420 224 431 111' },
      { id: 2, category: 'medicine', name: '–ü–æ–ª—ñ–∫–ª—ñ–Ω—ñ–∫–∞ –ü—Ä–∞–≥–∞ 1', coords: [50.082, 14.422], phone: '+420 123 456 789' },
      { id: 3, category: 'medicine', name: '–ê–ø—Ç–µ–∫–∞ ¬´–°–≤–æ–±–æ–¥–∞¬ª', coords: [50.073, 14.417], phone: '+420 987 654 321' },
      { id: 4, category: 'social', name: 'OAMP –ü—Ä–∞–≥–∞ 1', coords: [50.081, 14.423], phone: '+420 123 456 789' },
      { id: 5, category: 'social', name: '–í–æ–ª–æ–Ω—Ç–µ—Ä—Å—å–∫–∏–π —Ü–µ–Ω—Ç—Ä ¬´Pomoc¬ª', coords: [50.078, 14.450], phone: '+420 555 666 777' },
      { id: 6, category: 'shops', name: '–ú–∞–≥–∞–∑–∏–Ω Pomoc', coords: [50.075, 14.418], phone: '+420 987 654 321' },
      { id: 7, category: 'shops', name: '–ö—É—Ä—Å–∏ ¬´ƒåesky snadno¬ª', coords: [50.077, 14.421], phone: '+420 222 333 444' },
      { id: 8, category: 'law', name: '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è ¬´Pravda¬ª', coords: [50.087, 14.420], phone: '+420 555 123 456' },
      { id: 9, category: 'law', name: '–¶–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–≤–æ—ó –ø—ñ–¥—Ç—Ä–∏–º–∫–∏', coords: [50.083, 14.419], phone: '+420 555 654 321' }
    ];

    let markers = [];

    function updateMarkers(category) {
      markers.forEach(marker => map.removeLayer(marker));
      markers = [];

      const filtered = category === 'all' ? points : points.filter(p => p.category === category);
      filtered.forEach(p => {
        const m = L.marker(p.coords).addTo(map).bindPopup(`<strong>${p.name}</strong><br>${p.phone}`);
        markers.push(m);
      });
    }

    updateMarkers('all');
  </script>
</body>
</html>
