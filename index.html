<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>–ü—Ä–∞–≥–∞-–§—É—à–∫–∏ ‚Äî –î–æ–ø–æ–º–æ–≥–∞ —É–∫—Ä–∞—ó–Ω—Ü—è–º</title>
  <style>
    /* –°–±—Ä–æ—Å */
    * {
      box-sizing: border-box;
    }
    body, html {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fff;
      overflow: hidden;
    }
    /* –í–∫–ª–∞–¥–∫–∏ */
    .tabs {
      display: flex;
      background: #FFD700;
      justify-content: center;
      gap: 1rem;
      padding: 0.5rem 0;
    }
    .tabs button {
      background: transparent;
      border: none;
      padding: 0.7rem 1.5rem;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      color: #222;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
    }
    .tabs button.active {
      border-bottom: 3px solid #000;
      font-weight: 900;
    }
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤–∫–ª–∞–¥–æ–∫ */
    .tab-content {
      height: calc(100vh - 52px);
      display: none;
      overflow: hidden;
      position: relative;
    }
    .tab-content.active {
      display: flex;
      flex-direction: column;
    }

    /* --- –ß–∞—Ç --- */
    #chat {
      background: url('https://i.ibb.co/fbpjfnm/Prague.jpg') no-repeat center center;
      background-size: cover;
      color: white;
      text-shadow: 0 0 8px rgba(0,0,0,0.7);
      position: relative;
    }
    #chat .overlay {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1;
    }
    #chat-content {
      position: relative;
      z-index: 2;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 10px;
    }
    #chat-header {
      font-weight: 700;
      font-size: 1.2rem;
      padding: 8px;
      background: #FFD700cc;
      color: #000;
      text-align: center;
      border-radius: 5px;
      user-select: none;
    }
    #messages {
      flex-grow: 1;
      overflow-y: auto;
      margin-top: 10px;
      padding: 10px;
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      font-size: 1rem;
      line-height: 1.4;
      display: flex;
      flex-direction: column;
      gap: 8px;
      scroll-behavior: smooth;
    }
    .message {
      max-width: 70%;
      padding: 8px 12px;
      border-radius: 15px;
      word-wrap: break-word;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .message.sent {
      align-self: flex-end;
      background: #FFD700cc;
      color: #000;
      border-bottom-right-radius: 2px;
    }
    .message.received {
      align-self: flex-start;
      background: #444;
      color: #fff;
      border-bottom-left-radius: 2px;
    }
    .message img {
      max-width: 150px;
      max-height: 150px;
      margin-top: 5px;
      border-radius: 10px;
      object-fit: cover;
      cursor: pointer;
    }
    /* –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ */
    #chat-input-container {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      background: #222;
      padding: 10px;
      border-radius: 10px;
      align-items: center;
    }
    #text-input {
      flex-grow: 1;
      padding: 8px 12px;
      font-size: 1rem;
      border-radius: 20px;
      border: none;
      outline: none;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    #file-input {
      display: none;
    }
    #btn-photo {
      background: transparent;
      border: none;
      color: #FFD700;
      font-size: 1.5rem;
      cursor: pointer;
    }
    #send-btn {
      background: #FFD700;
      border: none;
      padding: 10px 18px;
      font-weight: 700;
      color: #000;
      border-radius: 20px;
      cursor: pointer;
      user-select: none;
      transition: background 0.3s ease;
    }
    #send-btn:hover {
      background: #e6c200;
    }
    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ */
    #register-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    #register-modal.active {
      display: flex;
    }
    #register-form {
      background: #fff;
      padding: 20px 30px;
      border-radius: 10px;
      max-width: 350px;
      width: 90vw;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    #register-form input {
      padding: 8px 12px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      outline: none;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    #register-form button {
      background: #FFD700;
      border: none;
      padding: 10px;
      font-weight: 700;
      cursor: pointer;
      border-radius: 10px;
      transition: background 0.3s ease;
    }
    #register-form button:hover {
      background: #e6c200;
    }
    /* –ö–∞—Ä—Ç–∞ */
    #map {
      height: 100%;
      width: 100%;
    }
    /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */
    #info-content {
      overflow-y: auto;
      padding: 20px;
      font-size: 1rem;
      line-height: 1.5;
      background: #fff8dc;
      color: #000;
    }
    #info-content h2 {
      margin-top: 0;
    }
    #info-content img {
      max-width: 100%;
      border-radius: 12px;
      margin: 10px 0;
    }
    /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
    @media (max-width: 600px) {
      .tabs {
        flex-wrap: wrap;
      }
      .tabs button {
        flex-grow: 1;
        font-size: 1rem;
        padding: 0.6rem 0;
      }
      #chat-input-container {
        flex-direction: column;
      }
      #text-input {
        width: 100%;
        border-radius: 12px;
      }
      #send-btn {
        width: 100%;
        border-radius: 12px;
      }
    }
  </style>
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
    integrity="sha256-sA+Rl6P4BWh+/2ku0FgNx0H6AuYsaMPOO1Q+wV1z+0I="
    crossorigin=""
  />
</head>
<body>

  <div class="tabs">
    <button class="tab-btn active" data-tab="chat">–ß–∞—Ç</button>
    <button class="tab-btn" data-tab="map">–ö–∞—Ä—Ç–∞</button>
    <button class="tab-btn" data-tab="info">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</button>
  </div>

  <!-- –ß–∞—Ç -->
  <section id="chat" class="tab-content active" aria-label="–ß–∞—Ç">
    <div class="overlay"></div>
    <div id="chat-content">
      <div id="chat-header">–®–∞–Ω–æ–≤–Ω—ñ —É–∫—Ä–∞—ó–Ω—Ü—ñ, —Ü–µ–π —Å–∞–π—Ç —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —â–æ–± –¥–æ–ø–æ–º–∞–≥–∞—Ç–∏ –Ω–∞—à–∏–º —Å–ø—ñ–≤–≤—ñ—Ç—á–∏–∑–Ω–∏–∫–∞–º.</div>
      <div id="messages" aria-live="polite" aria-relevant="additions"></div>
      <div id="chat-input-container">
        <input id="text-input" type="text" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." aria-label="–¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è" />
        <input type="file" id="file-input" accept="image/*" aria-label="–î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ" />
        <button id="btn-photo" title="–î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ üì∑" aria-label="–î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ">üì∑</button>
        <button id="send-btn" aria-label="–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
      </div>
    </div>
  </section>

  <!-- –ö–∞—Ä—Ç–∞ -->
  <section id="map" class="tab-content" aria-label="–ö–∞—Ä—Ç–∞ –¥–æ–ø–æ–º–æ–≥–∏">
    <div id="map"></div>
  </section>

  <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
  <section id="info" class="tab-content" aria-label="–ö–æ—Ä–∏—Å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è">
    <div id="info-content">
      <h2>–ö–æ—Ä–∏—Å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è —É–∫—Ä–∞—ó–Ω—Ü—ñ–≤ —É –ü—Ä–∞–∑—ñ</h2>
      <p>–¢—É—Ç –∑—ñ–±—Ä–∞–Ω—ñ –≤–∞–∂–ª–∏–≤—ñ –∫–æ–Ω—Ç–∞–∫—Ç–∏, –∞–¥—Ä–µ—Å–∏, —Ç–µ–ª–µ—Ñ–æ–Ω–∏ —Ç–∞ –ø–æ—Ä–∞–¥–∏, —â–æ–± –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∞–º —É —Å–∫–ª–∞–¥–Ω–∏–π —á–∞—Å.</p>
      <h3>–ú–µ–¥–∏—Ü–∏–Ω–∞</h3>
      <ul>
        <li>–õ—ñ–∫–∞—Ä–Ω—è –ú–æ—Ç–æ–ª ‚Äî –≤—É–ª. V √övalu 84, –ü—Ä–∞–≥–∞ 5</li>
        <li>–ü–æ–ª—ñ–∫–ª—ñ–Ω—ñ–∫–∞ –ü—Ä–∞–≥–∞ 1 ‚Äî –≤—É–ª. ≈†tƒõp√°nsk√° 28, –ü—Ä–∞–≥–∞ 1</li>
        <li>–®–≤–∏–¥–∫–∞ –¥–æ–ø–æ–º–æ–≥–∞ ‚Äî —Ç–µ–ª–µ—Ñ–æ–Ω 155</li>
      </ul>
      <h3>–°–æ—Ü—ñ–∞–ª—å–Ω—ñ —Å–ª—É–∂–±–∏</h3>
      <ul>
        <li>OAMP –ü—Ä–∞–≥–∞ 1 ‚Äî –≤—É–ª. Politick√Ωch vƒõz≈à≈Ø 910/10</li>
        <li>–í–æ–ª–æ–Ω—Ç–µ—Ä—Å—å–∫–∏–π —Ü–µ–Ω—Ç—Ä Pomoc ‚Äî –≤—É–ª. Lazarsk√° 7, –ü—Ä–∞–≥–∞ 1</li>
      </ul>
      <h3>–ú–∞–≥–∞–∑–∏–Ω–∏</h3>
      <ul>
        <li>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π –º–∞–≥–∞–∑–∏–Ω Pomoc ‚Äî –≤—É–ª. ≈†tƒõp√°nsk√° 25, –ü—Ä–∞–≥–∞ 1</li>
      </ul>
      <h3>–Æ—Ä–∏–¥–∏—á–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞</h3>
      <ul>
        <li>–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è Pravda ‚Äî –≤—É–ª. V√°clavsk√© n√°mƒõst√≠ 21, –ü—Ä–∞–≥–∞ 1</li>
      </ul>
      <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=800&q=80" alt="–ì—Ä–∞—Ñ—ñ—Ç—ñ —É –ü—Ä–∞–∑—ñ" />
      <p>–ü–∞–º'—è—Ç–∞–π—Ç–µ, —â–æ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ ‚Äî —Ü–µ –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–µ!</p>
    </div>
  </section>

  <!-- –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
  <div id="register-modal" role="dialog" aria-modal="true" aria-labelledby="register-title">
    <form id="register-form">
      <h2 id="register-title">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h2>
      <input type="text" id="reg-nick" placeholder="–ù—ñ–∫–Ω–µ–π–º" required autocomplete="off" />
      <input type="email" id="reg-email" placeholder="Email" required autocomplete="off" />
      <input type="password" id="reg-password" placeholder="–ü–∞—Ä–æ–ª—å" required autocomplete="off" />
      <button type="submit">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
    </form>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
    integrity="sha256-QVjd0z1Dt5IdZFRmOLmPJJsNVk9O0wWutRT6yJaaP8o="
    crossorigin=""
  ></script>

  <script>
    // === Firebase config ===
    const firebaseConfig = {
      apiKey: "AIzaSyDV2BslF-Ll37a1XO3GEfzNMXa7YsSXL1o",
      authDomain: "web-app-b4633.firebaseapp.com",
      databaseURL: "https://web-app-b4633-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "web-app-b4633",
      storageBucket: "web-app-b4633.firebasestorage.app",
      messagingSenderId: "1041887915171",
      appId: "1:1041887915171:web:84d62eae54e9291b47a316",
      measurementId: "G-C65BPE81SJ"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // --- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ ---
    const tabButtons = document.querySelectorAll(".tab-btn");
    const tabContents = document.querySelectorAll(".tab-content");
    tabButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        tabButtons.forEach(b => b.classList.remove("active"));
        tabContents.forEach(c => c.classList.remove("active"));
        btn.classList.add("active");
        const tab = btn.dataset.tab;
        document.getElementById(tab).classList.add("active");
      });
    });

    // --- –ß–∞—Ç ---
    const messagesEl = document.getElementById("messages");
    const textInput = document.getElementById("text-input");
    const fileInput = document.getElementById("file-input");
    const btnPhoto = document.getElementById("btn-photo");
    const sendBtn = document.getElementById("send-btn");

    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–Ω–∏–∫) –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–ª–∏ –∞–Ω–æ–Ω–∏–º–Ω—ã–π
    let currentUser = null;

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ localStorage –∏ Firebase Realtime Database
    async function loadMessages() {
      messagesEl.innerHTML = "";
      // –°–Ω–∞—á–∞–ª–∞ localStorage
      const localMessages = JSON.parse(localStorage.getItem("chatMessages") || "[]");
      localMessages.forEach(msg => addMessageToDOM(msg));

      // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ Firebase DB
      db.ref('messages').on('child_added', snapshot => {
        const msg = snapshot.val();
        addMessageToDOM(msg);
      });
    }

    // –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ DOM (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã)
    const messageIds = new Set();
    function addMessageToDOM(msg) {
      if (messageIds.has(msg.id)) return;
      messageIds.add(msg.id);

      const div = document.createElement("div");
      div.classList.add("message");
      div.classList.add(msg.uid === (currentUser ? currentUser.uid : "") ? "sent" : "received");

      let content = "";
      if (msg.nick) content += `<strong>${escapeHTML(msg.nick)}:</strong><br>`;
      if (msg.text) content += escapeHTML(msg.text);
      if (msg.image) content += `<br><img src="${msg.image}" alt="–§–æ—Ç–æ" />`;

      div.innerHTML = content;
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    function escapeHTML(str) {
      if (!str) return "";
      return str.replace(/[&<>"']/g, function(m) {
        return {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;'
        }[m];
      });
    }

    // –ö–Ω–æ–ø–∫–∞ —Ñ–æ—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
    btnPhoto.addEventListener("click", () => {
      fileInput.click();
    });

    // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    async function checkAuth() {
      return new Promise(resolve => {
        auth.onAuthStateChanged(user => {
          if (user) {
            currentUser = user;
            resolve(user);
          } else {
            currentUser = null;
            resolve(null);
          }
        });
      });
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    sendBtn.addEventListener("click", async () => {
      const text = textInput.value.trim();
      const file = fileInput.files[0];

      if (!text && !file) return;

      await checkAuth();
            if (!currentUser) {
        // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        registerModal.classList.add("active");
        return;
      }

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
      let imageUrl = null;

      if (file) {
        imageUrl = await uploadImage(file);
      }

      const messageData = {
        id: Date.now() + "-" + Math.random().toString(36).substr(2, 9),
        uid: currentUser.uid,
        nick: currentUser.displayName || currentUser.email || "–ê–Ω–æ–Ω—ñ–º",
        text: text || "",
        image: imageUrl,
        timestamp: Date.now()
      };

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase DB
      db.ref("messages/" + messageData.id).set(messageData);

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è offline (–ø–æ –∂–µ–ª–∞–Ω–∏—é)
      let localMessages = JSON.parse(localStorage.getItem("chatMessages") || "[]");
      localMessages.push(messageData);
      localStorage.setItem("chatMessages", JSON.stringify(localMessages));

      // –û—á–∏—Å—Ç–∏—Ç—å –∏–Ω–ø—É—Ç—ã
      textInput.value = "";
      fileInput.value = "";

      // –î–æ–±–∞–≤–∏—Ç—å –≤ DOM (—Å—Ä–∞–∑—É)
      addMessageToDOM(messageData);
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –≤ Firebase Storage
    async function uploadImage(file) {
      // –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Firebase Storage
      // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ Storage SDK
      // –í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –ø–æ–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —á–µ—Ä–µ–∑ Base64 –≤ RealtimeDB (–º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å)
      
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = function(evt) {
          const base64data = evt.target.result;
          // –ú–æ–∂–Ω–æ —Å—Ä–∞–∑—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å base64 –∫–∞–∫ src –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
          resolve(base64data);
        };
        reader.onerror = function(err) {
          alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Ñ–æ—Ç–æ.");
          reject(err);
        };
        reader.readAsDataURL(file);
      });
    }

    // –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    const registerModal = document.getElementById("register-modal");
    const registerForm = document.getElementById("register-form");

    registerForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const nick = document.getElementById("reg-nick").value.trim();
      const email = document.getElementById("reg-email").value.trim();
      const password = document.getElementById("reg-password").value.trim();

      if (!nick || !email || !password) {
        alert("–í—Å—ñ –ø–æ–ª—è –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ");
        return;
      }

      try {
        // –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firebase Auth
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å —Å –Ω–∏–∫–æ–º
        await user.updateProfile({ displayName: nick });

        currentUser = user;

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É
        registerModal.classList.remove("active");
        registerForm.reset();

        alert("–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–æ–π—à–ª–∞ —É—Å–ø—ñ—à–Ω–æ! –¢–µ–ø–µ—Ä –º–æ–∂–µ—Ç–µ –ø–∏—Å–∞—Ç–∏ –≤ —á–∞—Ç.");

      } catch (error) {
        alert("–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó: " + error.message);
      }
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ —Ñ–æ—Ä–º—ã
    registerModal.addEventListener("click", (e) => {
      if (e.target === registerModal) {
        registerModal.classList.remove("active");
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã Leaflet
    const map = L.map("map").setView([50.087, 14.421], 13); // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ü—Ä–∞–≥–∏

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // –ú–∞—Ä–∫–µ—Ä—ã –ø–æ–º–æ—â–∏ (–ø—Ä–∏–º–µ—Ä 20+)
    const helpPoints = [
      {
        name: "–õ—ñ–∫–∞—Ä–Ω—è –ú–æ—Ç–æ–ª",
        coords: [50.0497, 14.3866],
        desc: "–ì–æ–ª–æ–≤–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è –ü—Ä–∞–≥–∏."
      },
      {
        name: "–ü–æ–ª—ñ–∫–ª—ñ–Ω—ñ–∫–∞ –ü—Ä–∞–≥–∞ 1",
        coords: [50.0833, 14.4171],
        desc: "–ü–æ–ª—ñ–∫–ª—ñ–Ω—ñ–∫–∞ –¥–ª—è –º–µ—à–∫–∞–Ω—Ü—ñ–≤ —Ü–µ–Ω—Ç—Ä—É –º—ñ—Å—Ç–∞."
      },
      {
        name: "OAMP –ü—Ä–∞–≥–∞ 1",
        coords: [50.0835, 14.4112],
        desc: "–û—Ñ—ñ—Å —Å–æ—Ü—ñ–∞–ª—å–Ω–∏—Ö —Å–ª—É–∂–±."
      },
      {
        name: "–í–æ–ª–æ–Ω—Ç–µ—Ä—Å—å–∫–∏–π —Ü–µ–Ω—Ç—Ä Pomoc",
        coords: [50.0830, 14.4160],
        desc: "–î–æ–ø–æ–º–æ–≥–∞ –±—ñ–∂–µ–Ω—Ü—è–º —Ç–∞ –≤–æ–ª–æ–Ω—Ç–µ—Ä—Å—Ç–≤–æ."
      },
      // ... –î–æ–±–∞–≤—å —Å—é–¥–∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
      {
        name: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π –º–∞–≥–∞–∑–∏–Ω Pomoc",
        coords: [50.0840, 14.4175],
        desc: "–ü—Ä–æ–¥—É–∫—Ç–∏ –∑ –£–∫—Ä–∞—ó–Ω–∏."
      },
      {
        name: "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è Pravda",
        coords: [50.0828, 14.4200],
        desc: "–Æ—Ä–∏–¥–∏—á–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞ –¥–ª—è —É–∫—Ä–∞—ó–Ω—Ü—ñ–≤."
      },
      {
        name: "–®–≤–∏–¥–∫–∞ –¥–æ–ø–æ–º–æ–≥–∞",
        coords: [50.0875, 14.4210],
        desc: "–¢–µ–ª–µ—Ñ–æ–Ω 155"
      },
      // –î–æ–±–∞–≤—å—Ç–µ –µ—â–µ 15-20 —Ç–æ—á–µ–∫, —á—Ç–æ–±—ã –±—ã–ª–æ –º–Ω–æ–≥–æ
    ];

    helpPoints.forEach(point => {
      const marker = L.marker(point.coords).addTo(map);
      marker.bindPopup(`<b>${point.name}</b><br>${point.desc}`);
    });

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadMessages();

  </script>
</body>
</html>
